# Caddyfile for media compression app
# Caddy automatically handles SSL certificate provisioning via Let's Encrypt

# Replace with your domain
yourdomain.com {
    # Reverse proxy to the SvelteKit app
    reverse_proxy app:3000

    # The COOP/COEP headers are already set by SvelteKit,
    # but we ensure they're not stripped
    header {
        # Security headers
        X-Frame-Options "SAMEORIGIN"
        X-Content-Type-Options "nosniff"
        Referrer-Policy "strict-origin-when-cross-origin"
    }

    # Enable compression
    encode gzip zstd

    # Logging
    log {
        output file /var/log/caddy/access.log
        format json
    }
}

# For local development/testing without a domain, use:
# :80 {
#     reverse_proxy app:3000
# }
